<!-- 導航列 -->
<nav class="navbar">
  <div class="container">
    <a href="/" class="navbar-brand">
      <h1>佳里廣澤信仰宗教協會</h1>
    </a>
    <ul class="navbar-menu" id="navMenu">
      <li><a href="#about">關於協會</a></li>
      <li><a href="#deity">廣澤尊王</a></li>
      <li><a href="#culture">信仰文化</a></li>
      <li><a href="#events">法會活動</a></li>
      <li><a href="#light">光明燈</a></li>
      <li><a href="#donation">捐款護持</a></li>
    </ul>
    <div class="navbar-toggle" id="navToggle">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </div>
</nav>

<!-- 英雄區塊 -->
<header class="hero" id="home">
  <div class="hero-content">
    <p class="hero-deity">主祀 廣澤尊王</p>
    <h2>臺南市<span class="highlight">佳里廣澤</span>信仰宗教協會</h2>
    <p>
      弘揚廣澤尊王大慈大悲、濟世救苦之精神<br>
      推廣傳統宗教文化，淨化人心，促進地方祥和與社會安定
    </p>
    <p class="hero-status">
      <span class="status-badge">神尊雕刻中</span>
      誠邀信眾共襄盛舉
    </p>
    <div class="hero-buttons">
      <a href="#donation" class="btn btn-primary">護持捐款</a>
      <a href="#about" class="btn btn-outline">認識協會</a>
    </div>
  </div>
  <div class="hero-scroll">
    <span></span>
  </div>
</header>

<!-- 關於協會 -->
<section class="section about" id="about">
  <div class="container">
    <div class="section-title">
      <h2>關於協會</h2>
      <p>弘揚傳統信仰，服務社會大眾</p>
    </div>
    <div class="about-grid">
      <div class="about-image fade-in">
        <img src="/images/廣澤尊王進度01.jpg" alt="廣澤尊王神尊雕刻進度">
        <p class="image-caption">廣澤尊王神尊雕刻中</p>
      </div>
      <div class="about-content fade-in">
        <h3>臺南市佳里廣澤信仰宗教協會</h3>
        <p>
          本會為依法設立、非以營利為目的之公益性社會團體，以弘揚主祀廣澤尊王大慈大悲、濟世救苦之精神，推廣傳統宗教文化，淨化人心，並結合公益慈善，協助社會服務，促進地方祥和與社會安定為宗旨。
        </p>
        <p>
          協會致力於弘揚傳統信仰文化，辦理祈福交流、社區文化活動，促進地方和諧；推動宗教教育與知識傳承，並積極參與公益慈善活動，關懷弱勢族群。
        </p>
        <div class="about-features">
          <div class="feature-item">
            <div class="icon">誠</div>
            <span>誠心祈福</span>
          </div>
          <div class="feature-item">
            <div class="icon">德</div>
            <span>積德行善</span>
          </div>
          <div class="feature-item">
            <div class="icon">護</div>
            <span>護佑蒼生</span>
          </div>
          <div class="feature-item">
            <div class="icon">和</div>
            <span>和諧社會</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- 廣澤尊王介紹 -->
<section class="section deity-section" id="deity">
  <div class="container">
    <div class="section-title">
      <h2>廣澤尊王</h2>
      <p>大慈大悲 濟世救苦 威靈顯赫</p>
    </div>

    <!-- 神明聖號 -->
    <div class="deity-names fade-in">
      <div class="deity-title-card">
        <span class="title-label">聖號</span>
        <h3>廣澤尊王</h3>
      </div>
      <div class="deity-title-card">
        <span class="title-label">俗稱</span>
        <h3>郭聖王</h3>
      </div>
      <div class="deity-title-card">
        <span class="title-label">又稱</span>
        <h3>保安尊王</h3>
      </div>
      <div class="deity-title-card">
        <span class="title-label">尊稱</span>
        <h3>聖王公</h3>
      </div>
    </div>

    <!-- 神明介紹主區 -->
    <div class="deity-intro fade-in">
      <div class="deity-story">
        <div class="story-icon">傳</div>
        <h3>神明傳說</h3>
        <p>
          廣澤尊王，姓郭名忠福，後唐同光初年（西元923年）誕生於福建泉州南安縣小溪場（今南安市詩山鎮）。
          相傳尊王幼年喪父，與母親相依為命，以牧羊為生。尊王生性至孝，事母至誠，鄰里皆稱其為孝子。
        </p>
        <p>
          傳說尊王年僅十六歲時，於詩山鳳山寺後山坐化升天，羽化成神。當時天現祥雲，異香滿山，
          鄉民感其孝德，遂建廟奉祀，歷代靈驗事蹟不斷，香火鼎盛。
        </p>
      </div>
      <div class="deity-story">
        <div class="story-icon">孝</div>
        <h3>孝感動天</h3>
        <p>
          尊王最為人稱道的是其「孝」德。相傳尊王為了侍奉母親，不辭辛勞，每日牧羊於山間，
          將所得供養母親。其孝行感動天地，得道成神後，更以「孝」為教化世人之本。
        </p>
        <p>
          民間流傳：「廣澤尊王，孝感通天，有求必應，庇佑萬民。」
          信眾祈求尊王庇佑，不僅可得平安順遂，更能感受尊王以孝道教化人心的精神。
        </p>
      </div>
    </div>

    <!-- 神蹟與庇佑 -->
    <div class="deity-miracles">
      <div class="miracle-card fade-in">
        <div class="miracle-icon">靈</div>
        <h3>威靈顯赫</h3>
        <p>廣澤尊王神威顯赫，歷代皇帝多有敕封。宋、元、明、清各朝均有加封，尊號由「忠佑聖侯」累封至「威鎮廣澤尊王」。</p>
      </div>
      <div class="miracle-card fade-in">
        <div class="miracle-icon">護</div>
        <h3>護國佑民</h3>
        <p>尊王曾多次顯靈護國，平定盜寇、消弭災厄。凡遇天災人禍，信眾虔誠祈禱，尊王必定庇佑，化險為夷。</p>
      </div>
      <div class="miracle-card fade-in">
        <div class="miracle-icon">醫</div>
        <h3>濟世救苦</h3>
        <p>相傳尊王精通醫術，常於夢中指點信眾治病良方。許多疑難雜症，經祈求尊王後皆能痊癒，神蹟流傳至今。</p>
      </div>
      <div class="miracle-card fade-in">
        <div class="miracle-icon">財</div>
        <h3>賜福納財</h3>
        <p>尊王亦主掌事業財運，凡誠心祈求者，皆能得到尊王賜福，事業順利、財源廣進、闔家平安。</p>
      </div>
    </div>

    <!-- 聖誕千秋 -->
    <div class="deity-birthday fade-in">
      <div class="birthday-content">
        <div class="birthday-icon">誕</div>
        <div class="birthday-info">
          <h3>廣澤尊王聖誕千秋</h3>
          <p class="birthday-date">農曆二月廿二日</p>
          <p>每逢聖誕，本會舉辦盛大祝壽法會，信眾虔誠祝禱，祈求尊王庇佑，合境平安。</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- 信仰文化 -->
<section class="section culture-section" id="culture">
  <div class="container">
    <div class="section-title">
      <h2>信仰文化</h2>
      <p>傳承千年 福澤綿延</p>
    </div>
    <div class="culture-grid">
      <div class="culture-card fade-in">
        <div class="culture-header">
          <span class="culture-icon">香</span>
          <h3>敬香禮儀</h3>
        </div>
        <div class="culture-content">
          <p><strong>三炷香的意義：</strong></p>
          <ul>
            <li>第一炷：敬天地神明</li>
            <li>第二炷：敬祖先聖賢</li>
            <li>第三炷：敬十方眾生</li>
          </ul>
          <p class="culture-tip">敬香時心誠則靈，雙手合十，默念所求，心存善念。</p>
        </div>
      </div>
      <div class="culture-card fade-in">
        <div class="culture-header">
          <span class="culture-icon">拜</span>
          <h3>參拜流程</h3>
        </div>
        <div class="culture-content">
          <ol>
            <li>淨手淨心，整理儀容</li>
            <li>點香三炷，雙手持香</li>
            <li>向神明行三鞠躬禮</li>
            <li>稟報姓名、住址、生辰</li>
            <li>虔誠祈願，默念所求</li>
            <li>插香於爐，再行三禮</li>
          </ol>
        </div>
      </div>
      <div class="culture-card fade-in">
        <div class="culture-header">
          <span class="culture-icon">燈</span>
          <h3>點燈意涵</h3>
        </div>
        <div class="culture-content">
          <p><strong>光明燈的由來：</strong></p>
          <p>點燈象徵以光明照亮前程，驅除黑暗與厄運。燈火長明，代表神明恆常庇佑，護佑信眾一年平安。</p>
          <p class="culture-tip">「燈」與「丁」諧音，亦有添丁發財、人丁興旺之意。</p>
        </div>
      </div>
      <div class="culture-card fade-in">
        <div class="culture-header">
          <span class="culture-icon">願</span>
          <h3>協會願景</h3>
        </div>
        <div class="culture-content">
          <p><strong>凝聚信眾・弘揚信仰</strong></p>
          <p>本會神尊正在雕刻製作中。我們期盼：</p>
          <ul>
            <li>凝聚在地廣澤尊王信眾</li>
            <li>傳承閩南傳統信仰文化</li>
            <li>建立信眾交流平台</li>
            <li>推動公益慈善活動</li>
          </ul>
          <p class="culture-tip">誠摯邀請有志之士加入，共同弘揚廣澤尊王信仰。</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- 服務項目 -->
<section class="section" id="services" style="background: var(--cream);">
  <div class="container">
    <div class="section-title">
      <h2>服務項目</h2>
      <p>為信眾提供各項宗教服務</p>
    </div>
    <div class="services-grid" style="color: var(--black);">
      <div class="service-card fade-in" style="background: var(--white); border-color: var(--gold);">
        <div class="icon">燈</div>
        <h3 style="color: var(--dark-brown);">光明燈</h3>
        <p style="color: #666;">點燃光明燈，為自身及家人祈求平安順遂、光明照耀，一年吉祥如意。</p>
        <a href="#light" class="btn btn-primary">了解更多</a>
      </div>
      <div class="service-card fade-in" style="background: var(--white); border-color: var(--gold);">
        <div class="icon">福</div>
        <h3 style="color: var(--dark-brown);">祈福法會</h3>
        <p style="color: #666;">舉辦各項祈福法會，消災解厄、增福添慧，獲得神明庇佑。</p>
        <a href="#events" class="btn btn-primary">查看法會</a>
      </div>
      <div class="service-card fade-in" style="background: var(--white); border-color: var(--gold);">
        <div class="icon">安</div>
        <h3 style="color: var(--dark-brown);">安太歲</h3>
        <p style="color: #666;">為犯太歲者祈安植福，化解流年不順，趨吉避凶。</p>
        <a href="#donation" class="btn btn-primary">了解更多</a>
      </div>
    </div>
  </div>
</section>

<!-- 法會活動 -->
<section class="section events" id="events">
  <div class="container">
    <div class="section-title">
      <h2>法會活動</h2>
      <p>傳承信仰・虔誠奉祀</p>
    </div>
    <div class="events-grid">
      <div class="event-card fade-in">
        <div class="image">
          <img src="/images/event-spring.jpg" alt="新春祈福法會">
        </div>
        <div class="content">
          <span class="date">農曆正月</span>
          <h3>新春祈福法會</h3>
          <p>新年開春祈福，為信眾點燈祈安，祈求新年平安順利、萬事如意。</p>
        </div>
      </div>
      <div class="event-card fade-in">
        <div class="image">
          <img src="/images/event-birthday.jpg" alt="廣澤尊王聖誕祝壽法會">
        </div>
        <div class="content">
          <span class="date">農曆二月廿二</span>
          <h3>廣澤尊王聖誕</h3>
          <p>恭祝廣澤尊王聖誕千秋，舉辦盛大祝壽法會，信眾虔誠祝禱。</p>
        </div>
      </div>
      <div class="event-card fade-in">
        <div class="image">
          <img src="/images/event-ghost.jpg" alt="中元普渡法會">
        </div>
        <div class="content">
          <span class="date">農曆七月</span>
          <h3>中元普渡法會</h3>
          <p>中元節超薦法會，普渡眾生，祈求陰陽兩利、合境平安。</p>
        </div>
      </div>
      <div class="event-card fade-in">
        <div class="image">
          <img src="/images/event-thanksgiving.jpg" alt="謝平安法會">
        </div>
        <div class="content">
          <span class="date">農曆十二月</span>
          <h3>謝平安法會</h3>
          <p>歲末謝平安，感謝神明一年庇佑，祈求來年吉祥如意。</p>
        </div>
      </div>
      <div class="event-card fade-in">
        <div class="image">
          <img src="/images/event-chanting.jpg" alt="誦經祈福法會">
        </div>
        <div class="content">
          <span class="date">每月初一、十五</span>
          <h3>誦經祈福</h3>
          <p>每月固定誦經祈福，為信眾消災祈福，增添福慧。</p>
        </div>
      </div>
      <div class="event-card fade-in">
        <div class="image">
          <img src="/images/event-charity.jpg" alt="公益慈善活動">
        </div>
        <div class="content">
          <span class="date">不定期</span>
          <h3>公益慈善活動</h3>
          <p>結合宗教信仰推動公益慈善，關懷弱勢族群，回饋社會。</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- 線上點燈 -->
<section class="section light-offering" id="light">
  <div class="container">
    <div class="section-title">
      <h2>線上點燈</h2>
      <p>點燈祈福・光明照耀</p>
    </div>
    <div class="light-grid">
      <div class="light-card fade-in">
        <div class="lantern-image">
          <img src="/images/財力燈.jpg" alt="財力燈">
        </div>
        <h3>財力燈</h3>
        <div class="price">NT$ 600 <span>/年</span></div>
        <ul>
          <li>祈求財運亨通</li>
          <li>招財進寶興旺</li>
          <li>每月誦經迴向</li>
        </ul>
        <a href="#donation" class="btn btn-outline" onclick="selectDonationType('light_peace', 600)">我要點燈</a>
      </div>
      <div class="light-card featured fade-in">
        <div class="lantern-image">
          <img src="/images/光明燈.jpg" alt="光明燈">
        </div>
        <h3>光明燈</h3>
        <div class="price">NT$ 1,200 <span>/年</span></div>
        <ul>
          <li>祈求事業順利</li>
          <li>全年光明照耀</li>
          <li>每月誦經迴向</li>
          <li>重大法會加持</li>
        </ul>
        <a href="#donation" class="btn btn-secondary" onclick="selectDonationType('light_bright', 1200)">我要點燈</a>
      </div>
      <div class="light-card fade-in">
        <div class="lantern-image">
          <img src="/images/太歲燈.jpg" alt="太歲燈">
        </div>
        <h3>太歲燈</h3>
        <div class="price">NT$ 1,500 <span>/年</span></div>
        <ul>
          <li>化解犯太歲</li>
          <li>趨吉避凶</li>
          <li>全年安太歲庇佑</li>
          <li>專屬祈福法會</li>
        </ul>
        <a href="#donation" class="btn btn-outline" onclick="selectDonationType('light_tai', 1500)">我要點燈</a>
      </div>
    </div>
    <p style="opacity: 0.8; margin-top: 2rem;">
      線上登記後，請於捐款區完成付款，協會將於收款後為您安排點燈事宜
    </p>
  </div>
</section>

<!-- 捐款區塊 -->
<section class="section donation" id="donation">
  <div class="container">
    <div class="section-title">
      <h2>捐款護持</h2>
      <p>您的善心護持，是協會前進的動力</p>
    </div>
    <div class="donation-content">
      <div class="donation-info fade-in">
        <h3>功德無量 福報綿延</h3>
        <p>
          您的每一份捐款都將用於弘揚廣澤尊王信仰、推動宗教文化活動、
          關懷弱勢族群，以及維護宗教文化場所。感謝您的善心護持！
        </p>
        <div class="donation-methods">
          <div class="donation-method">
            <div class="icon">香</div>
            <div>
              <strong>香油錢</strong>
              <p>隨喜功德，不拘金額</p>
            </div>
          </div>
          <div class="donation-method">
            <div class="icon">功</div>
            <div>
              <strong>功德金</strong>
              <p>法會建醮、祈福消災</p>
            </div>
          </div>
          <div class="donation-method">
            <div class="icon">建</div>
            <div>
              <strong>建設基金</strong>
              <p>場所維護、文化保存</p>
            </div>
          </div>
        </div>
      </div>
      <div class="donation-form fade-in">
        <h4>線上捐款登記</h4>
        <form id="donationForm">
          <div class="form-group">
            <label>捐款項目</label>
            <select name="donation_type" id="donationType" required>
              <option value="">請選擇捐款項目</option>
              <option value="light_peace">財力燈</option>
              <option value="light_bright">光明燈</option>
              <option value="light_tai">太歲燈</option>
              <option value="incense">香油錢</option>
              <option value="merit">功德金</option>
              <option value="construction">建設基金</option>
              <option value="membership">會員費用</option>
            </select>
          </div>
          <div class="form-group">
            <label>捐款金額</label>
            <div class="amount-buttons">
              <button type="button" class="amount-btn" data-amount="500">500</button>
              <button type="button" class="amount-btn" data-amount="1000">1,000</button>
              <button type="button" class="amount-btn" data-amount="2000">2,000</button>
              <button type="button" class="amount-btn" data-amount="3000">3,000</button>
              <button type="button" class="amount-btn" data-amount="5000">5,000</button>
              <button type="button" class="amount-btn" data-amount="10000">10,000</button>
            </div>
            <input type="number" name="amount" id="amountInput" placeholder="或輸入其他金額" min="100">
          </div>
          <div class="form-group">
            <label>姓名（功德芳名）<span class="required">*</span></label>
            <input type="text" name="donor_name" placeholder="請輸入您的姓名" required>
          </div>
          <div class="form-group">
            <label>聯絡電話（選填）</label>
            <input type="tel" name="phone" placeholder="請輸入聯絡電話">
          </div>
          <div class="form-group">
            <label>付款方式<span class="required">*</span></label>
            <select name="payment_method" id="paymentMethod" required>
              <option value="">請選擇付款方式</option>
              <option value="credit_card">信用卡</option>
              <option value="cvs_barcode">超商條碼</option>
              <option value="cvs_code">超商代碼</option>
              <option value="virtual_account">虛擬帳號</option>
            </select>
          </div>
          <div class="form-group checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" name="needs_receipt" id="needsReceipt" value="true">
              <span>需要收據（電子發票）</span>
            </label>
            <p class="form-hint">勾選後需填寫電子信箱，收據將以電子郵件寄送（無紙化）</p>
          </div>
          <div class="form-group" id="emailGroup">
            <label>電子信箱<span class="required" id="emailRequired" style="display: none;">*</span></label>
            <input type="email" name="email" id="emailInput" placeholder="請輸入電子信箱">
            <p class="form-hint">需要收據時必填</p>
          </div>
          <div class="form-group">
            <label>祈福內容（選填）</label>
            <textarea name="prayer" rows="3" placeholder="請輸入您的祈福內容..."></textarea>
          </div>
          <button type="submit" class="btn btn-primary" style="width: 100%;">
            前往付款
          </button>
          <p style="text-align: center; margin-top: 1rem; font-size: 0.9rem; color: #666;">
            * 提交後將導向綠界金流進行安全付款
          </p>
        </form>
      </div>
    </div>
  </div>
</section>

<!-- 頁尾 -->
<footer class="footer">
  <div class="container">
    <div class="footer-grid">
      <div class="footer-brand">
        <h3>臺南市佳里廣澤信仰宗教協會</h3>
        <p>
          弘揚廣澤尊王大慈大悲、濟世救苦之精神，推廣傳統宗教文化，
          淨化人心，促進地方祥和與社會安定。
        </p>
      </div>
      <div class="footer-links">
        <h4>快速連結</h4>
        <ul>
          <li><a href="#about">關於協會</a></li>
          <li><a href="#deity">廣澤尊王</a></li>
          <li><a href="#services">服務項目</a></li>
          <li><a href="#events">法會活動</a></li>
        </ul>
      </div>
      <div class="footer-links">
        <h4>信眾服務</h4>
        <ul>
          <li><a href="#light">線上光明燈</a></li>
          <li><a href="#donation">捐款護持</a></li>
          <li><a href="#events">法會報名</a></li>
          <li><a href="#about">聯絡我們</a></li>
        </ul>
      </div>
      <div class="footer-contact">
        <h4>聯絡資訊</h4>
        <p>地址：臺南市佳里區安南路438號</p>
        <p>電話：<a href="tel:0903084107">0903-084-107</a></p>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; <%= Time.current.year %> 臺南市佳里廣澤信仰宗教協會 版權所有</p>
    </div>
  </div>
</footer>

<script>
// 選擇捐款類型
function selectDonationType(type, amount) {
  document.getElementById('donationType').value = type;
  document.getElementById('amountInput').value = amount;
  // 移除所有按鈕的 active 狀態
  document.querySelectorAll('.amount-btn').forEach(function(b) {
    b.classList.remove('active');
  });
}

// 切換電子信箱必填狀態
function toggleEmailRequired() {
  var needsReceipt = document.getElementById('needsReceipt').checked;
  var emailRequired = document.getElementById('emailRequired');
  var emailInput = document.getElementById('emailInput');

  if (needsReceipt) {
    emailRequired.style.display = 'inline';
    emailInput.setAttribute('required', 'required');
  } else {
    emailRequired.style.display = 'none';
    emailInput.removeAttribute('required');
  }
}

// 覆寫表單提交
document.addEventListener('DOMContentLoaded', function() {
  // 監聽收據勾選變化
  var needsReceiptCheckbox = document.getElementById('needsReceipt');
  if (needsReceiptCheckbox) {
    needsReceiptCheckbox.addEventListener('change', toggleEmailRequired);
  }

  var form = document.getElementById('donationForm');
  if (form) {
    form.addEventListener('submit', function(e) {
      e.preventDefault();

      var formData = new FormData(form);
      var data = {
        donation: {}
      };
      formData.forEach(function(value, key) {
        if (key === 'needs_receipt') {
          data.donation[key] = true;
        } else {
          data.donation[key] = value;
        }
      });

      // 如果沒勾選，設為 false
      if (!formData.has('needs_receipt')) {
        data.donation.needs_receipt = false;
      }

      // 驗證必填欄位
      if (!data.donation.donation_type || !data.donation.donor_name || !data.donation.amount || !data.donation.payment_method) {
        showMessage('請填寫必填欄位（捐款項目、金額、姓名、付款方式）', 'error');
        return;
      }

      // 驗證收據需要電子信箱
      if (data.donation.needs_receipt && !data.donation.email) {
        showMessage('需要收據時必須填寫電子信箱', 'error');
        return;
      }

      // 提交到 Rails API
      fetch('/donations', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'application/json'
        },
        body: JSON.stringify(data)
      })
      .then(function(response) { return response.json(); })
      .then(function(result) {
        if (result.success) {
          showMessage(result.message, 'success');
          // 導向付款頁面
          if (result.payment_url) {
            setTimeout(function() {
              window.location.href = result.payment_url;
            }, 1000);
          }
        } else {
          showMessage(result.message + (result.errors ? ': ' + result.errors.join(', ') : ''), 'error');
        }
      })
      .catch(function(error) {
        console.error('Error:', error);
        showMessage('系統錯誤，請稍後再試', 'error');
      });
    });
  }
});
</script>
